#+title: Quant Finance Mini Project 1
#+author: Aatmun Baxi
#+ipynb-newcell

* Project Statement
*Use current stock data to create two potentially profitable investment portfolios. One that is higher risk and one that is lower risk.*

*You are to explain your interpretation of a high risk profile and low risk profile of a portfolio. You should provide some measurable quantitative data in you explanation.*

#+ipynb-newcell
* Portfolio Choice and Motivation
It is well documented that investors that invest for consumption goals in the long term (i.e. to fund consumption >10 years from the beginning of investment) can maximize expected return and minimize risk—as defined by volatility and probability of (un)realized capital loss—by holding broadly diversified, low cost index funds of risky assests with expected returns in excess of 3 month US treasury bills.
Furthermore, it is financial dogma to hold differing proportions of the more "risky" stocks and "safer" bonds according to how close the investor is to their date of their consumption beginning.

We take the persona of a young investor, defined as an investor entering a risky portfolio of stocks and bonds to fund consumption occurring a least 25 years in the future.
We accept the dogma of investing in low cost, total market index funds to hold long term, and base /both/ of our portfolios on the following assumptions:

1. Invest in total market index funds at a 90% stock/10% bond split
2. Stocks should be diversified globally
3. The bond portion will be zero coupon 25+ year Treasury STRIPS

We  introduce a 10% bond allocation due to its curtailing of psychological risk and improving of risk-adjusted returns.
Moreover, our duration exposure to the bonds should be in line with our consumption timeline.
As such, we adopt ultra-long dated Treasury STRIPS, as opposed to a total bond market fund, which would have an average duration in the intermediate length of ~6 years.
It has been demonstrated that STRIPS have lower correlation with stocks than intermediate date bonds, and would provide a stronger diversification benefit, which is desirable in our framework.
We will give empirical evidence for this fact.

Our "low risk" portfolio will consist of 90% global stocks at *current* market cap weights and 10% 25+ year US Treasury STRIPS.

| Asset             |  % |
|-------------------+----|
| Total US Stock    | 57 |
| Total ex-US Stock | 33 |
| 25+ STRIPS        | 10 |

The choice of using current market cap weights for the US and ex-US geographies is to make the portfolio comparable to the high risk portfolio.

#+ipynb-newcell
* Risk Factors as Sources of Increased Risk
In Capital Asset Pricing Model (CAPM), the "low" risk portfolio would be nearly the riskiest portfolio one can come up with, when only compensated risks are accounted for.
A compensated risk is a source of risk that an investor can expect to be compensated for, while an investor taking on uncompensated risk cannot expect to increase their returns for doing so.
Examples of uncompensated risks are concentration risk, where assets are highly concentrated into one asset (e.g. a particular stock), and idiosyncratic country risk, where one concentrates their stock holdings in a particular country's stock market.

The common thread of uncompensated risk is that they can be eliminated with diversification, something that the "optimal" portfolio in the CAPM model supports.
Our portfolios will also strive to take on only compensated risks, but short of having a 100% stock allocation, our "low risk" portfolio is already about as risky as we can get.
One then wonders, how can we take on more *compensated* risk to produce a higher risk portfolio than the one we have already?

The work of Eugene Fama and Kenneth French provide a possible answer.
In short, Fama and French observed excess alpha (broadly-occurring return in excess of the market portfolio) in certain stocks that the CAPM could not explain.
Statistically, the CAPM could only explain 70% of the returns a diversified portfolio of stocks.
Fama and French sought to modify the pricing model to explain more of the returns.

Summarizing their body of research, they proposed two additional /risk factors/: the size risk factor and value risk factor.
By measuring a diversified stock portfolio's exposure to companies with smaller size (known as "small cap" companies) and with lower price-to-book values (known as "value" companies), Fama and French were able to increase the explanatory power of the CAPM from 70% to >90% with their additional risk factors.
Their model is called the Fama-French three-factor model.

The risk factors in this model are
1. Market beta (exposure to diversified stock)
2. Size
3. Value

It should be noted that the model improves on the CAPM /empirically/ in how it explains returns, but past returns do not predict the future.
However, there are good reasons to believe thse addition risk factors should be compensated ones.

#+ipynb-newcell
* The High Risk Portfolio
The three factor model predicts that a portfolio with higher exposure to small cap companies and value companies can give returns higher than the market portfolio.
This is the basis for our high risk portfolio.

Sticking with the 90/10 stock/STRIPS allocation, we allocate 50% of each of our geography's stock markets to small cap value companies in that geography.

For example, at current market capitalizations, US stocks consist of approximately 64% of the world's free-float market capitalization, with ex-US contributing the remaining 36%.
In our low risk portfolio, we allocated 90% of our assets to this split, so our geography breakdown would be \(0.9\ast 0.64 = 57\%\) total US market, and \(0.9\ast 0.36 = 33\%\) total ex-US stock market.

In our high risk portfolio, these would be halved to \(28\% \) and \(17\%\) for US and ex-US total market, respectively, making way for \(29\%\) and \(16\%\) US and ex-US small cap value, respectively.

The choice of \(50\% \) dedicated to small cap value in each geography is somewhat arbitrary, and is likely considered a very aggressive tilt to the size and value factors.
Our high risk portfolio is then
| Asset                 |  % |
|-----------------------+----|
| Total US Stock        | 28 |
| US Small Cap Value    | 29 |
| Total ex-US Stock     | 29 |
| ex-US Small Cap Value | 16 |
| 25+ STRIPS            | 10 |
#+ipynb-newcell
* Risk of Small Cap Value
Though we have used the three factor model to incorporate new sources of risk into our high risk portfolio, it turns out that we have incorporated assets that have higher risk even in traditional metrics of risk such as volatitily.
Let us demonstrate this empirically.

We will use the Dimensional funds' DFSVX and DISVX as our representative tickers for US small cap value and ex-US small cap value, respectively.
We will compare the volatility of these funds against their respective geography's total stock markets, represented by =VTI= and =VXUS= for US and ex-US.

In order to capture the *total* return of these assets, we choose to use data from [[https://testfol.io][testfolio]], a portfolio backtesting tool that captures total returns of a portfolio, not just price action like Yahoo Finance.
The data we load gives the hypothetical growth of 4 portfolios, each invested 100% into one of the assets above.

#+begin_src jupyter-python :session MiniProject1
import datetime as dt
us_exus = pd.read_csv("./us-exus.csv")
# us_exus.index = pd.to_datetime(us_exus["Date"])
us_exus.set_index(pd.to_datetime(us_exus["Date"]),inplace=True)
us_exus.drop("Date",axis=1,inplace=True)
us_exus.plot(rot=70)
#+end_src

#+RESULTS:
:RESULTS:
: <Axes: xlabel='Date'>
[[file:./.ob-jupyter/834561ca30bf12f12c03791a8a0eeca063f89556.png]]
:END:
#+ipynb-newcell
#+begin_src jupyter-python :session MiniProject1
day_returns = (us_exus.shift(1) -us_exus) / us_exus
day_returns.describe()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DFSVX</th>
      <th>VTISIM</th>
      <th>DISVX</th>
      <th>VXUSSIM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7651.000000</td>
      <td>7651.000000</td>
      <td>7651.000000</td>
      <td>7651.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.000310</td>
      <td>-0.000329</td>
      <td>-0.000236</td>
      <td>-0.000150</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.014256</td>
      <td>0.012106</td>
      <td>0.010205</td>
      <td>0.011621</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.095405</td>
      <td>-0.102305</td>
      <td>-0.082483</td>
      <td>-0.108270</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.007275</td>
      <td>-0.006124</td>
      <td>-0.005561</td>
      <td>-0.005997</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.001066</td>
      <td>-0.000791</td>
      <td>-0.000592</td>
      <td>-0.000673</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.006148</td>
      <td>0.004571</td>
      <td>0.004290</td>
      <td>0.004984</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.150000</td>
      <td>0.140214</td>
      <td>0.110549</td>
      <td>0.115700</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export
#+ipynb-newcell
With the data of daily returns in hand, we can compare volatilities over the period from June 1996 to today.
#+ipynb-newcell
#+begin_src jupyter-python :session MiniProject1
import numpy as np
log_returns = np.log(day_returns+1).dropna()
# log_returns.describe()
np.sqrt(252)*log_returns.describe().loc["std"]
#+end_src

#+RESULTS:
: DFSVX      0.225398
: VTISIM     0.191638
: DISVX      0.161345
: VXUSSIM    0.183918
: Name: std, dtype: float64

#+ipynb-newcell
One can see that the volatility of returns of US small cap value is higher than the total stock market index, while it is slightly lower in the ex-US geography.
In this sense, adding these assets to the low risk portfolio increases the volatility, making it higher risk in traditional metrics.
We can also visually inspect a histogram of daily returns and see how they are distributed.
#+ipynb-newcell
#+begin_src jupyter-python :session MiniProject1
day_returns.plot(kind="hist",bins=70,xlabel = "Return",
                 xlim=(-.035,.035),ylabel = "Observations",subplots=True,layout=(2,2),title = "Distribution of daily returns within $\pm 3.5\%$.")
#+end_src

#+RESULTS:
:RESULTS:
: array([[<Axes: xlabel='Return', ylabel='Observations'>,
:         <Axes: xlabel='Return', ylabel='Observations'>],
:        [<Axes: xlabel='Return', ylabel='Observations'>,
:         <Axes: xlabel='Return', ylabel='Observations'>]], dtype=object)
[[file:./.ob-jupyter/6444c35ee2368d7de4f5ba1149fadfeae2e10655.png]]
:END:

The US small cap value asset has fatter tails than
* Bond Returns Time Series

#+begin_src jupyter-python :session MiniProject1
%matplotlib inline
import matplotlib.pyplot as plt
import pandas as pd
import yfinance as yf
import numpy as np
#+end_src

#+RESULTS:

#+begin_src jupyter-python :session MiniProject1
bond_value = pd.read_csv("./Return(1).csv")
bond_value.index = pd.to_datetime(bond_value["Date"])
bond_value.drop("Date",axis=1)
bond_value.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>ZROZSIM</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1962-01-02</th>
      <td>1962-01-02</td>
      <td>10000.00</td>
    </tr>
    <tr>
      <th>1962-01-03</th>
      <td>1962-01-03</td>
      <td>10001.56</td>
    </tr>
    <tr>
      <th>1962-01-04</th>
      <td>1962-01-04</td>
      <td>10030.05</td>
    </tr>
    <tr>
      <th>1962-01-05</th>
      <td>1962-01-05</td>
      <td>10004.66</td>
    </tr>
    <tr>
      <th>1962-01-08</th>
      <td>1962-01-08</td>
      <td>9979.34</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export
#+ipynb-newcell
#+begin_src jupyter-python :session MiniProject1
returns = (bond_value["ZROZSIM"].shift(1) - bond_value["ZROZSIM"] ) / bond_value["ZROZSIM"]
returns.name = 'Return'
returns = pd.concat([bond_value, returns],axis=1)
returns.index = pd.to_datetime(returns["Date"])
returns.drop("Date",axis=1)
returns.rename(columns={"ZROZSIM": "Hypothetical Value"},inplace=True)
returns.describe()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hypothetical Value</th>
      <th>Return</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>15956.000000</td>
      <td>15955.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>158867.525691</td>
      <td>-0.000101</td>
    </tr>
    <tr>
      <th>std</th>
      <td>203069.619789</td>
      <td>0.015428</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2170.820000</td>
      <td>-0.176333</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9505.440000</td>
      <td>-0.007931</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>48974.245000</td>
      <td>-0.000229</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>247422.165000</td>
      <td>0.007054</td>
    </tr>
    <tr>
      <th>max</th>
      <td>883767.220000</td>
      <td>0.214581</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export

#+ipynb-newcell
We now have a time series giving the daily returns of a portfolio of treasuries simulating the holdings of =ZROZ=, which will represent our bond portion of each portfolio.



# Local Variables:
# eval: (setq! jupyter-executable (executable-find "jupyter"))
# End:
